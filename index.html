<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Self-Transfer Time Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #0072ce; /* Aruba flag blue */
            color: #fff;
            text-align: center;
            margin: 0;
            padding: 0;
        }
        .container {
            margin: 20px;
            padding: 20px;
            background-color: #f4a900; /* Aruba flag yellow */
            border-radius: 10px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        textarea {
            font-size: 16px;
            margin: 10px 0;
            padding: 10px;
            width: 90%;
            height: 100px;
            max-width: 500px;
            border: none;
            border-radius: 5px;
            resize: none;
        }
        button {
            background-color: #ce1126; /* Aruba flag red */
            color: #fff;
            cursor: pointer;
        }
        button:hover {
            opacity: 0.9;
        }
        .result {
            font-size: 18px;
            margin-top: 20px;
            text-align: left;
            white-space: pre-wrap;
            background-color: #fff;
            color: #000;
            padding: 15px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>Self-Transfer Time Calculator</h1>
    <div class="container">
        <form id="transferForm">
            <label for="firstTicket">Paste Your First Ticket Information Below:</label><br>
            <textarea id="firstTicket" placeholder="Paste your first ticket details..."></textarea><br>

            <label for="secondTicket">Paste Your Second Ticket Information Below:</label><br>
            <textarea id="secondTicket" placeholder="Paste your second ticket details..."></textarea><br>

            <button type="button" onclick="processTickets()">Calculate Transfer Time</button>
        </form>

        <div id="result" class="result"></div>
    </div>

    <script>
        function extractInfoFromTicket(text) {
            const info = {};
            const lines = text.split('\n');

            function extractTimeAndAirport(line) {
                const timeRegex = /[0-2]?[0-9]:[0-5][0-9](\s?[APap][Mm])?/;
                const match = line.match(timeRegex);
                if (match) {
                    const time = match[0];
                    const airport = line.replace(time, '').trim();
                    return { time, airport };
                }
                return null;
            }

            function extractDate(line) {
                const dateRegex = /\b(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s([A-Za-z]{3})\s(\d{1,2})\b/;
                const match = line.match(dateRegex);

                if (match) {
                    const monthName = match[1];
                    const day = match[2];
                    const months = {
                        Jan: 1, Feb: 2, Mar: 3, Apr: 4, May: 5, Jun: 6,
                        Jul: 7, Aug: 8, Sep: 9, Oct: 10, Nov: 11, Dec: 12
                    };
                    const month = months[monthName];
                    const currentYear = new Date().getFullYear();
                    return `${month}/${day}/${currentYear}`;
                }
                return null;
            }

            for (const line of lines) {
                const timeAndAirport = extractTimeAndAirport(line);
                if (timeAndAirport) {
                    if (!info.arrivalTime) {
                        info.arrivalTime = timeAndAirport.time;
                        info.arrivalAirport = timeAndAirport.airport;
                    } else if (!info.departureTime) {
                        info.departureTime = timeAndAirport.time;
                        info.departureAirport = timeAndAirport.airport;
                    }
                }

                if (!info.date) {
                    const date = extractDate(line);
                    if (date) {
                        info.date = date;
                    }
                }
            }

            return info;
        }

        function combineDateAndTime(date, time) {
            const [month, day, year] = date.split('/');
            return new Date(`${year}-${month}-${day} ${time}`);
        }

        function formatResult(firstInfo, firstArrival, secondInfo, secondDeparture, transferTimeMinutes) {
            const hours = Math.floor(transferTimeMinutes / 60);
            const minutes = transferTimeMinutes % 60;

            return (
                `First Ticket:\n` +
                `Arrival Time: ${firstInfo.arrivalTime || 'N/A'} at ${firstInfo.arrivalAirport || 'N/A'}\n` +
                `Departure Time: ${firstInfo.departureTime || 'N/A'} from ${firstInfo.departureAirport || 'N/A'}\n` +
                `Date: ${firstInfo.date || 'N/A'}\n\n` +
                `Second Ticket:\n` +
                `Arrival Time: ${secondInfo.arrivalTime || 'N/A'} at ${secondInfo.arrivalAirport || 'N/A'}\n` +
                `Departure Time: ${secondInfo.departureTime || 'N/A'} from ${secondInfo.departureAirport || 'N/A'}\n` +
                `Date: ${secondInfo.date || 'N/A'}\n\n` +
                `Transfer Time: ${hours} hrs ${minutes} mins`
            );
        }

        async function processTickets() {
            const firstTicket = document.getElementById('firstTicket').value;
            const secondTicket = document.getElementById('secondTicket').value;

            if (!firstTicket || !secondTicket) {
                document.getElementById('result').innerText = 'Please provide both tickets information.';
                return;
            }

            const firstInfo = extractInfoFromTicket(firstTicket);
            const secondInfo = extractInfoFromTicket(secondTicket);

            const missingFields = [];
            if (!firstInfo.arrivalTime) missingFields.push('First Ticket Arrival Time');
            if (!firstInfo.date) missingFields.push('First Ticket Date');
            if (!secondInfo.departureTime) missingFields.push('Second Ticket Departure Time');
            if (!secondInfo.date) missingFields.push('Second Ticket Date');

            if (missingFields.length > 0) {
                document.getElementById('result').innerText = `Missing or invalid fields: ${missingFields.join(', ')}.`;
                return;
            }

            const firstArrival = combineDateAndTime(firstInfo.date, firstInfo.arrivalTime);
            const secondDeparture = combineDateAndTime(secondInfo.date, secondInfo.departureTime);

            if (secondDeparture.getTime() === firstArrival.getTime()) {
                document.getElementById('result').innerText =
                    'Second flight departs at the same time as the first flight arrives. Transfer is not feasible.';
                return;
            } else if (secondDeparture < firstArrival) {
                secondDeparture.setDate(secondDeparture.getDate() + 1);
            }

            try {
                const transferTimeMinutes = (secondDeparture - firstArrival) / (1000 * 60);

                if (transferTimeMinutes <= 0) {
                    document.getElementById('result').innerText =
                        'Second flight departs before the first flight arrives. Transfer is not feasible.';
                    return;
                }

                const formattedResult = formatResult(firstInfo, firstArrival, secondInfo, secondDeparture, transferTimeMinutes);
                document.getElementById('result').innerText = formattedResult;
            } catch (error) {
                document.getElementById('result').innerText = `Error: ${error.message}`;
            }
        }
    </script>
</body>
</html>
