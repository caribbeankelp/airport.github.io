<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Self-Transfer Time Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #0072ce; /* Aruba flag blue */
            color: #fff;
            text-align: center;
            margin: 0;
            padding: 0;
        }
        .container {
            margin: 20px;
            padding: 20px;
            background-color: #f4a900; /* Aruba flag yellow */
            border-radius: 10px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        textarea {
            font-size: 16px;
            margin: 10px 0;
            padding: 10px;
            width: 90%;
            height: 100px;
            max-width: 500px;
            border: none;
            border-radius: 5px;
            resize: none;
        }
        button {
            background-color: #ce1126; /* Aruba flag red */
            color: #fff;
            cursor: pointer;
        }
        button:hover {
            opacity: 0.9;
        }
        .result {
            font-size: 18px;
            margin-top: 20px;
            text-align: left;
            white-space: pre-wrap;
            background-color: #fff;
            color: #000;
            padding: 15px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>Self-Transfer Time Calculator</h1>
    <div class="container">
        <form id="transferForm">
            <label for="firstTicket">Paste Your First Ticket Information Below:</label><br>
            <textarea id="firstTicket" placeholder="Paste your first ticket details..."></textarea><br>

            <label for="secondTicket">Paste Your Second Ticket Information Below:</label><br>
            <textarea id="secondTicket" placeholder="Paste your second ticket details..."></textarea><br>

            <button type="button" onclick="processTickets()">Calculate Transfer Time</button>
        </form>

        <div id="result" class="result"></div>
    </div>

    <script>
        function parseTime(timeStr) {
            const [time, modifier] = timeStr.trim().split(/\s+/);
            let [hours, minutes] = time.split(':').map(Number);

            if (modifier === 'PM' && hours !== 12) {
                hours += 12;
            } else if (modifier === 'AM' && hours === 12) {
                hours = 0;
            }

            return { hours, minutes };
        }

        function extractInfoFromTicket(text) {
            const lines = text.split('\n');
            const info = {};

            lines.forEach(line => {
                line = line.trim();

                if (line.includes('+1')) {
                    info.nextDayArrival = true; // Marks arrival as the next day
                } else if (line.includes('-1')) {
                    info.previousDayArrival = true; // Marks arrival as the previous day
                }

                if (/\d{1,2}:\d{2}\s?(AM|PM)/.test(line)) {
                    const timeMatch = line.match(/\d{1,2}:\d{2}\s?(AM|PM)/)[0];
                    if (!info.arrivalTime) {
                        info.arrivalTime = timeMatch;
                        info.arrivalAirport = line.split(timeMatch)[1].trim();
                    } else if (!info.departureTime) {
                        info.departureTime = timeMatch;
                        info.departureAirport = line.split(timeMatch)[1].trim();
                    }
                }
            });

            return info;
        }

        function processTickets() {
            const firstTicket = document.getElementById('firstTicket').value;
            const secondTicket = document.getElementById('secondTicket').value;

            if (!firstTicket || !secondTicket) {
                document.getElementById('result').innerText = 'Please provide both tickets information.';
                return;
            }

            const firstInfo = extractInfoFromTicket(firstTicket);
            const secondInfo = extractInfoFromTicket(secondTicket);

            if (!firstInfo.arrivalTime || !secondInfo.departureTime) {
                document.getElementById('result').innerText = 'Could not extract valid time information from one or both tickets.';
                return;
            }

            const firstArrival = parseTime(firstInfo.arrivalTime);
            const secondDeparture = parseTime(secondInfo.departureTime);

            let arrivalMinutes = firstArrival.hours * 60 + firstArrival.minutes;
            let departureMinutes = secondDeparture.hours * 60 + secondDeparture.minutes;

            // Adjust for +1 (next day arrival)
            if (firstInfo.nextDayArrival) {
                arrivalMinutes += 1440; // Add one day in minutes for arrival
            }

            // Adjust for -1 (previous day arrival)
            if (firstInfo.previousDayArrival) {
                arrivalMinutes -= 1440; // Subtract one day in minutes for arrival
            }

            if (secondDeparture.minutes < arrivalMinutes) {
                document.getElementById('result').innerText =
                    'Second flight departs before or at the same time as the first flight arrives. Transfer is not feasible.';
                return;
            }

            const transferTime = departureMinutes - arrivalMinutes;

            const formattedResult = (
                `First Ticket:\n` +
                `Arrival Time: ${firstInfo.arrivalTime || 'N/A'} at ${firstInfo.arrivalAirport || 'N/A'}\n\n` +
                `Second Ticket:\n` +
                `Departure Time: ${secondInfo.departureTime || 'N/A'} from ${secondInfo.departureAirport || 'N/A'}\n\n` +
                `Transfer Time: ${Math.floor(transferTime / 60)} hrs ${transferTime % 60} mins`
            );

            document.getElementById('result').innerText = formattedResult;
        }
    </script>
</body>
</html>
