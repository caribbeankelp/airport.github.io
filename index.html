<!DOCTYPE html>
<html lang="en">
<head>
    <!-- 保持原有head部分不变 -->
</head>
<body class="bg-gray-100 min-h-screen p-4">
    <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-md p-6">
        <!-- 保持原有标题和控制台不变 -->

        <!-- 动态机票表单保持不变 -->

        <button type="submit" form="mainForm" class="w-full bg-blue-600 text-white py-3 rounded-lg mt-6">
            Calculate All Transfers
        </button>

        <!-- 结果展示区 -->
        <div id="results" class="mt-6 space-y-4 hidden">
            <!-- 结果将由JavaScript动态生成 -->
        </div>
    </div>

<script>
// 保持原有全局变量和初始化函数不变

// 🔥 新增保险推荐函数（带HTML格式化）
function recommendInsurance(riskyTransfers) {
    return riskyTransfers.length > 0 ? 
        `<span class="text-red-600 font-bold">Allianz Multi-Trip</span> (覆盖项目：<br>
        - 航班延误（2小时起赔）<br>
        - 行李丢失（500美元赔偿)<br>
        - 转机失败住宿补偿)` : 
        `<span class="text-green-600 font-bold">Basic Coverage</span> (覆盖项目：<br>
        - 行李丢失（200美元赔偿))`;
}

function calculate(e) {
    e.preventDefault();
    // ...保持原有数据收集和验证逻辑...

    // 🔥 新增风险转机点检测
    const riskyTransfers = transferPoints.filter(point => {
        const transferTime = Math.round((point.nextDeparture - point.arrival) / 60000);
        return transferTime < SECURITY_TIMES[document.getElementById('country').value];
    });

    // 生成转机结果
    const results = transferPoints.map((point, idx) => {
        // ...保持原有结果生成逻辑...
    });

    // 🔥 新增保险推荐区块
    const insuranceBlock = `
        <div class="p-4 bg-yellow-50 rounded-lg border-2 border-yellow-200 shadow-md">
            <div class="flex items-center mb-2">
                <svg class="w-6 h-6 mr-2 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                </svg>
                <h3 class="text-lg font-bold text-yellow-800">保险推荐</h3>
            </div>
            <div class="pl-8">
                <p class="text-gray-700">${recommendInsurance(riskyTransfers)}</p>
                <p class="mt-3 text-sm ${riskyTransfers.length > 0 ? 'text-red-600' : 'text-green-600'}">
                    ${riskyTransfers.length > 0 ? 
                        `⚠️ 检测到 ${riskyTransfers.length} 个高风险转机点，建议购买全面保险` : 
                        `✅ 当前行程风险在可控范围内`}
                </p>
            </div>
        </div>
    `;

    // 组合最终结果
    document.getElementById('results').innerHTML = [
        ...results,
        insuranceBlock // 加入保险推荐
    ].join('');
    document.getElementById('results').classList.remove('hidden');
}

// 保持其他工具函数不变
</script>
</body>
</html>
