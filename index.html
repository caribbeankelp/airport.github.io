<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Self-Transfer Time Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #0072ce; /* Aruba flag blue */
            color: #fff;
            text-align: center;
            margin: 0;
            padding: 0;
        }
        .container {
            margin: 20px;
            padding: 20px;
            background-color: #f4a900; /* Aruba flag yellow */
            border-radius: 10px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        textarea {
            font-size: 16px;
            margin: 10px 0;
            padding: 10px;
            width: 90%;
            height: 100px;
            max-width: 500px;
            border: none;
            border-radius: 5px;
            resize: none;
        }
        button {
            background-color: #ce1126; /* Aruba flag red */
            color: #fff;
            cursor: pointer;
        }
        button:hover {
            opacity: 0.9;
        }
        .result {
            font-size: 18px;
            margin-top: 20px;
            text-align: left;
            white-space: pre-wrap;
            background-color: #fff;
            color: #000;
            padding: 15px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>Self-Transfer Time Calculator</h1>
    <div class="container">
        <form id="transferForm">
            <label for="firstTicket">Paste Your First Ticket Information Below:</label><br>
            <textarea id="firstTicket" placeholder="Paste your first ticket details..."></textarea><br>

            <label for="secondTicket">Paste Your Second Ticket Information Below:</label><br>
            <textarea id="secondTicket" placeholder="Paste your second ticket details..."></textarea><br>

            <button type="button" onclick="processTickets()">Calculate Transfer Time</button>
        </form>

        <div id="result" class="result"></div>
    </div>

    <script>
        function extractInfoFromTicket(text) {
            const lines = text.split('\n');
            const info = {};

            lines.forEach(line => {
                line = line.trim();

                // Match time in various formats (12-hour or 24-hour)
                if (/[0-2]?\d:[0-5]\d(\s?[APap][Mm])?/.test(line)) {
                    const timeMatch = line.match(/[0-2]?\d:[0-5]\d(\s?[APap][Mm])?/)[0];
                    if (!info.arrivalTime) {
                        info.arrivalTime = timeMatch;
                        info.arrivalAirport = line.replace(timeMatch, '').trim();
                    } else if (!info.departureTime) {
                        info.departureTime = timeMatch;
                        info.departureAirport = line.replace(timeMatch, '').trim();
                    }
                }
            });

            return info;
        }

        async function processTickets() {
            const firstTicket = document.getElementById('firstTicket').value;
            const secondTicket = document.getElementById('secondTicket').value;

            if (!firstTicket || !secondTicket) {
                document.getElementById('result').innerText = 'Please provide both tickets information.';
                return;
            }

            const firstInfo = extractInfoFromTicket(firstTicket);
            const secondInfo = extractInfoFromTicket(secondTicket);

            if (!firstInfo.arrivalTime || !secondInfo.departureTime) {
                document.getElementById('result').innerText = 'Could not extract valid time information from one or both tickets.';
                return;
            }

            // Get the current date
            const currentDate = new Date();
            const currentDateString = currentDate.toISOString().split('T')[0]; // Format: YYYY-MM-DD

            // Combine date with time
            const firstArrivalString = `${currentDateString} ${firstInfo.arrivalTime}`;
            const secondDepartureString = `${currentDateString} ${secondInfo.departureTime}`;

            // Create Date objects
            const firstArrival = new Date(firstArrivalString);
            const secondDeparture = new Date(secondDepartureString);

            // Handle overnight flights (if the second departure time is earlier than the first arrival time)
            if (secondDeparture <= firstArrival) {
                secondDeparture.setDate(secondDeparture.getDate() + 1); // Move second departure to the next day
            }

            try {
                const transferTimeMinutes = (secondDeparture - firstArrival) / (1000 * 60);

                if (transferTimeMinutes <= 0) {
                    document.getElementById('result').innerText =
                        'Second flight departs before or at the same time as the first flight arrives. Transfer is not feasible.';
                    return;
                }

                const hours = Math.floor(transferTimeMinutes / 60);
                const minutes = transferTimeMinutes % 60;

                const formattedResult = (
                    `First Ticket:\n` +
                    `Arrival Time: ${firstInfo.arrivalTime || 'N/A'} at ${firstInfo.arrivalAirport || 'N/A'}\n` +
                    `Departure Time: ${firstInfo.departureTime || 'N/A'} from ${firstInfo.departureAirport || 'N/A'}\n\n` +
                    `Second Ticket:\n` +
                    `Arrival Time: ${secondInfo.arrivalTime || 'N/A'} at ${secondInfo.arrivalAirport || 'N/A'}\n` +
                    `Departure Time: ${secondInfo.departureTime || 'N/A'} from ${secondInfo.departureAirport || 'N/A'}\n\n` +
                    `Transfer Time: ${hours} hrs ${minutes} mins`
                );

                document.getElementById('result').innerText = formattedResult;
            } catch (error) {
                document.getElementById('result').innerText = `Error: ${error.message}`;
            }
        }
    </script>
</body>
</html>
